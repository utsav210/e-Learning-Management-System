{% load static %}
<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Reset Password | eLMS</title>
      <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/icon/apple-touch-icon.png' %}">
      <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/icon/favicon-32x32.png' %}">
      <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/icon/favicon-16x16.png' %}">
      <link rel="manifest" href="{% static 'images/icon/site.webmanifest' %}">
      <link rel="stylesheet" href="{% static 'styles/bootstrap.min.css' %}">
      <link rel="stylesheet" href="{% static 'styles/style.css' %}">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
   </head>
   <body>
      <div class="container">
         <div style="min-height:85vh" class="row justify-content-center align-items-center">
            <div class="col-lg-5 col-sm-12 p-5 rounded shadow">
               <div class="text-center mb-4">
                  <h4 class="fw-bold mb-2">
                     <span class="material-symbols-outlined" style="font-size: 2.5rem; color: #10b981;">lock_open</span>
                  </h4>
                  <h5 class="mb-3 fw-bold">Reset Password</h5>
                  <p class="text-muted">Enter your new password</p>
               </div>
               
               {% if messages %}
               {% for message in messages %}
               <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
               </div>
               {% endfor %}
               {% endif %}
               
               <form action="{% url 'resetPassword' %}" method="post" id="resetForm">
                  {% csrf_token %}
                  <div class="mb-3">
                     <label for="new_password" class="form-label">New Password <span class="text-danger">*</span></label>
                     <input type="password" class="form-control" id="new_password" name="new_password" required placeholder="Enter new password" minlength="8" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}">
                     <div class="form-text">Minimum 8 characters with uppercase, lowercase, number, and special character</div>
                  </div>
                  <div class="mb-3">
                     <label for="confirm_password" class="form-label">Confirm Password <span class="text-danger">*</span></label>
                     <input type="password" class="form-control" id="confirm_password" name="confirm_password" required placeholder="Confirm new password" minlength="8">
                     <div id="passwordMatch" class="form-text"></div>
                  </div>
                  <div class="d-grid">
                     <button type="submit" class="btn btn-primary">
                        <span class="material-symbols-outlined me-2" style="font-size: 18px; vertical-align: middle;">lock_reset</span>
                        Reset Password
                     </button>
                  </div>
                  <div class="text-center mt-3">
                     <p class="text-muted small">After resetting your password, you will be redirected to the login page.</p>
                  </div>
               </form>
            </div>
         </div>
      </div>
      <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
      <link rel="stylesheet" href="{% static 'styles/material-theme.css' %}">
      <script src="{% static 'js/ui.js' %}"></script>
      <script nonce="{{ request.csp_nonce }}">
         // Password match validation
         const newPassword = document.getElementById('new_password');
         const confirmPassword = document.getElementById('confirm_password');
         const passwordMatch = document.getElementById('passwordMatch');
         
         function checkPasswordMatch() {
            if (confirmPassword.value === '') {
               passwordMatch.textContent = '';
               confirmPassword.classList.remove('is-invalid', 'is-valid');
               return;
            }
            
            if (newPassword.value === confirmPassword.value) {
               passwordMatch.textContent = '✓ Passwords match';
               passwordMatch.className = 'form-text text-success';
               confirmPassword.classList.remove('is-invalid');
               confirmPassword.classList.add('is-valid');
            } else {
               passwordMatch.textContent = '✗ Passwords do not match';
               passwordMatch.className = 'form-text text-danger';
               confirmPassword.classList.remove('is-valid');
               confirmPassword.classList.add('is-invalid');
            }
         }
         
         newPassword.addEventListener('input', checkPasswordMatch);
         confirmPassword.addEventListener('input', checkPasswordMatch);
         
         document.getElementById('resetForm').addEventListener('submit', function(e) {
            if (newPassword.value !== confirmPassword.value) {
               e.preventDefault();
               alert('Passwords do not match!');
               return false;
            }
         });
      </script>
   </body>
</html>

